<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
        >

<mapper namespace="com.sksun.blog.mapper.ArticleMapper">
    <select id="findArticleById" resultMap="articleMap">
        SELECT a.id a_id,
               a.title a_title,
               a.content content,
               a.author author,
               a.category_id a_category_id,
               c.id c_id,
               c.name c_name,
               t.id tag_id,
               t.name tag_name
        FROM article a
                 JOIN category c ON c.id = a.category_id
                 left join article_tag at on a.id = at.article_id
                 join tag t on t.id = at.tag_id
        where a.id = #{id}
    </select>
    <resultMap id="articleMap" type="Article">
        <result property="id" column="a_id"/>
        <result property="title" column="a_title"/>
        <result property="content" column="content"/>
        <result property="author" column="author"/>
        <result property="categoryId" column="a_category_id"/>
        <association property="category" javaType="Category">
            <id property="id" column="c_id"/>
            <result property="name" column="c_name"/>
        </association>
        <collection property="tagSet" ofType="Tag">
            <result property="id" column="tag_id"/>
            <result property="name" column="tag_name"/>
        </collection>
    </resultMap>

</mapper>